# –ö–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–æ–µ–∫—Ç–∞: Zero-Kelvin Store (zks)

## 1. –û–±–∑–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞
**Zero-Kelvin Store (zks)** ‚Äî —ç—Ç–æ CLI-—É—Ç–∏–ª–∏—Ç–∞ (fish-—Ñ—É–Ω–∫—Ü–∏—è) –¥–ª—è **–≤—ã–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö** (Cold Storage) –≤ —Å—Ä–µ–¥–µ Arch Linux.
–í –æ—Ç–ª–∏—á–∏–µ –æ—Ç —Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è (—Ü–µ–ª—å –∫–æ—Ç–æ—Ä—ã—Ö ‚Äî –∏–∑–±—ã—Ç–æ—á–Ω–æ—Å—Ç—å), `zks` –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è ¬´–∑–∞–º–æ—Ä–æ–∑–∫–∏¬ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö: –ø–µ—Ä–µ–Ω–æ—Å–∞ –∏—Ö —Å –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ö–æ—Å—Ç–∞ –Ω–∞ –≤–Ω–µ—à–Ω–µ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ (NAS/HDD) –¥–ª—è –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è –¥–∏—Å–∫–æ–≤–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞, —Å–æ—Ö—Ä–∞–Ω—è—è –ø—Ä–∏ —ç—Ç–æ–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ª–µ–≥–∫–æ ¬´—Ä–∞–∑–º–æ—Ä–æ–∑–∏—Ç—å¬ª (–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å) –∏—Ö –æ–±—Ä–∞—Ç–Ω–æ.

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:** –≤ –≤–∏–¥–µ fish-—Ñ—É–Ω–∫—Ü–∏–∏, —Å–∞–º–æ–µ –∏–º—è fish-—Ñ—É–Ω–∫—Ü–∏–∏ `zero-kelvin-store.fish`, `zks` —ç—Ç–æ  –µ—ë –≤–æ–∑–º–æ–∂–Ω—ã–π –±—É–¥—É—â–∏–π –∞–ª–ª–∏–∞—Å.

**–§–∏–ª–æ—Å–æ—Ñ–∏—è –∏ —Ü–µ–ª–∏:**
* **Offloading (–í—ã–≥—Ä—É–∑–∫–∞):** –ö–æ–Ω—Ü–µ–ø—Ç—É–∞–ª—å–Ω–æ —ç—Ç–æ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö, –∞ –Ω–µ –ø—Ä–æ—Å—Ç–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ.
    * *–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:* –î–∞–Ω–Ω—ã–µ –∫–æ–ø–∏—Ä—É—é—Ç—Å—è –≤ –æ–±—Ä–∞–∑ SquashFS, –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è, –∏ —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è –∞—Ä—Ö–∏–≤–∞ –∏—Å—Ö–æ–¥–Ω—ã–µ —Ñ–∞–π–ª—ã —É–¥–∞–ª—è—é—Ç—Å—è —Å –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –¥–∏—Å–∫–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –ø–æ –∫–æ–º–∞–Ω–¥–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–ª–∏ —Ñ–ª–∞–≥–æ–º, –ø–æ-—É–º–æ–ª—á–∞–Ω–∏—é –Ω–µ —É–¥–∞–ª—è—é—Ç—Å—è, –æ—Å—Ç–∞—é—Ç—Å—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ —É–¥–∞–ª–µ–Ω–∏—è –≤—Ä—É—á–Ω—É—é ).
* ** –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: Zero-Knowledge (–ü—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å):** –ê—Ä—Ö–∏–≤—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å ¬´—á–µ—Ä–Ω—ã–º–∏ —è—â–∏–∫–∞–º–∏¬ª. –ë–µ–∑ –∫–ª—é—á–∞ –¥–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è –Ω–∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ, –Ω–∏ –∏–º–µ–Ω–∞ —Ñ–∞–π–ª–æ–≤, –Ω–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–∞—Ç–∞–ª–æ–≥–æ–≤ –Ω–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤–∏–¥–Ω—ã.
    * *–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:* –°–∞–º–∞ `zks` –Ω–µ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—é. –û–Ω–∞ –¥–µ–ª–µ–≥–∏—Ä—É–µ—Ç —ç—Ç—É –∑–∞–¥–∞—á—É –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ `squash_manager`, –ø–µ—Ä–µ–¥–∞–≤–∞—è –µ–π —Ñ–ª–∞–≥ `-e` (–∏–ª–∏ `--encrypt`), —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ç–∞–∫–æ–π –∂–µ —Ñ–ª–∞–≥ –±—ã–ª –ø–µ—Ä–µ–¥–∞–Ω —Å–∞–º–æ–π `zks`.
* **Contextual Sets (–ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ –Ω–∞–±–æ—Ä—ã):** –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–∑—Ä–æ–∑–Ω–µ–Ω–Ω—ã–µ –ø—É—Ç–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `/home/user/project` + `/etc/project.conf`) –ø–æ–¥ –æ–¥–Ω–∏–º –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–º –∞—Ä—Ö–∏–≤–∞ (ID).
* **Low Friction (–ú–∏–Ω–∏–º—É–º —Ç—Ä–µ–Ω–∏—è):** –ü—Ä–æ—Ü–µ—Å—Å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º. –£—Ç–∏–ª–∏—Ç–∞ —Å–∞–º–∞ –∑–Ω–∞–µ—Ç –∏—Å—Ö–æ–¥–Ω—ã–µ –ø—É—Ç–∏ —Ñ–∞–π–ª–æ–≤ –±–ª–∞–≥–æ–¥–∞—Ä—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–º—É –º–∞–Ω–∏—Ñ–µ—Å—Ç—É.
* **–ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ SquashFS –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø—Ä–∏–º–æ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –∞—Ä—Ö–∏–≤ –∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –±–µ–∑ –ø–æ–ª–Ω–æ–π —Ä–∞—Å–ø–∞–∫–æ–≤–∫–∏.

## 2. –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –û—Å–Ω–æ–≤–Ω–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å
–ü—Ä–æ–µ–∫—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–∞—Å—Ç–æ–º–Ω–æ–π fish-—Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å–æ SquashFS –∏ LUKS.
**–°—Å—ã–ª–∫–∞:** [squash_manager.fish](../squash_manager.fish) (–î–æ–ª–∂–Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —Å–æ–∑–¥–∞–Ω–∏—è, –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —Ä–∞–∑–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –æ–±—Ä–∞–∑–æ–≤).
–¢–∞–∫–∂–µ –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ —Ç–æ–≥–æ, —á—Ç–æ –æ—Å—Ç–∞–ª–æ—Å—å –ø–æ—Å–ª–µ –±–∏–Ω–¥–∏–Ω–≥–æ–≤ –≤ `/tmp`, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏—è [rm-if-empty](../rm-if-empty.fish) –∫–∞–∫ –±–æ–ª–µ–µ –±–µ–∑–æ–ø–∞—Å–Ω–∞—è –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ `rm -rf` 
–î–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è [get_root_cmd.fish](../squash_manager.fish) (–Ω–∞–ø—Ä–∏–º–µ—Ä –Ω–∞ —Ç–æ—Ç —Å–ª—É—á–∞–π, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–º–µ—Å—Ç–æ sudo –∏—Å–ø–æ–ª—å–∑—É–µ—Ç doas) 

### –§–æ—Ä–º–∞—Ç —Ö—Ä–∞–Ω–µ–Ω–∏—è
* **–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä:** SquashFS (—Å–∂–∞—Ç–∏–µ Zstd).
* **–®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ:** LUKS2 (—á–µ—Ä–µ–∑ –≤—ã–∑–æ–≤ `squash_manager` —Å —Ñ–ª–∞–≥–æ–º `-e`) –ï—Å–ª–∏ —Å–∞–º–æ–π `zks` –±—ã–ª –ø–µ—Ä–µ–¥–∞–Ω —Ñ–ª–∞–≥ `-e`,  –µ—Å–ª–∏ –Ω–µ—Ç, —Ç–æ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è.
* **–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (–ü–æ–¥—Ö–æ–¥ ¬´–ù—É–º–µ—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤¬ª):**
    –ß—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –∫–æ–ª–ª–∏–∑–∏–π –∏–º–µ–Ω  –ø—Ä–∏ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–∏ —Ä–∞–∑–Ω—ã—Ö –ø—É—Ç–µ–π, —Ñ–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –≤–Ω—É—Ç—Ä–∏ –∞—Ä—Ö–∏–≤–∞ –¥–æ–ª–∂–Ω–∞ –∏–º–µ—Ç—å —Å–ª–µ–¥—É—é—â—É—é —Å—Ç—Ä–æ–≥—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É:
    ```text
    / (–∫–æ—Ä–µ–Ω—å squashfs)
    ‚îú‚îÄ‚îÄ to_restore/
    ‚îÇ   ‚îú‚îÄ‚îÄ 1/          # –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è 1-–≥–æ –ø—É—Ç–∏ –∏–∑ —Å–ø–∏—Å–∫–∞
    ‚îÇ   ‚îú‚îÄ‚îÄ 2/          # –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è 2-–≥–æ –ø—É—Ç–∏ –∏–∑ —Å–ø–∏—Å–∫–∞
    ‚îÇ   ‚îî‚îÄ‚îÄ N/          # –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è N-–≥–æ –ø—É—Ç–∏
    ‚îî‚îÄ‚îÄ list.yaml       # –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –º–∞–Ω–∏—Ñ–µ—Å—Ç, —Å–≤—è–∑—ã–≤–∞—é—â–∏–π ID –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –ø—É—Ç—è–º–∏
    ```
    *–ü—Ä–∏–º–µ—Ä —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ `list.yaml`:*
    ```yaml
    files:
      - id: 1
        path: /home/user/my_project
        type: directory
      - id: 2
        path: /etc/nginx/sites-available/my_project.conf
        type: file
    metadata:
      host: arch-laptop
      date: 2026-01-27
      id: my_backup_id
    ```

### –ü—Ä–æ—Ü–µ—Å—Å —Å–±–æ—Ä–∫–∏ (–ò–∑–æ–ª—è—Ü–∏—è)
–ß—Ç–æ–±—ã —Å–æ–±—Ä–∞—Ç—å –∞—Ä—Ö–∏–≤ –∏–∑ —Ä–∞–∑—Ä–æ–∑–Ω–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ –±–µ–∑ —Ñ–∏–∑–∏—á–µ—Å–∫–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –≥–∏–≥–∞–±–∞–π—Ç–æ–≤ –¥–∞–Ω–Ω—ã—Ö –≤–æ –≤—Ä–µ–º–µ–Ω–Ω—É—é –ø–∞–ø–∫—É `/tmp`, —É—Ç–∏–ª–∏—Ç–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **Linux Namespaces** –∏ **Bind Mounts**.

**–ê–ª–≥–æ—Ä–∏—Ç–º:**
1.  –ó–∞–ø—É—Å–∫ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ –∏–º–µ–Ω (namespace): `unshare -m --propagation private`.
2.  –°–æ–∑–¥–∞–Ω–∏–µ —Å–∫–µ–ª–µ—Ç–∞ –∫–∞—Ç–∞–ª–æ–≥–æ–≤ –≤–æ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –ø–∞–ø–∫–µ `/tmp`.
3.  **Bind Mount:** –ò—Å—Ö–æ–¥–Ω—ã–µ —Ñ–∞–π–ª—ã –∏ –∫–∞—Ç–∞–ª–æ–≥–∏ –º–æ–Ω—Ç–∏—Ä—É—é—Ç—Å—è (—á–µ—Ä–µ–∑ `mount --bind`) –≤–Ω—É—Ç—Ä—å —Å–∫–µ–ª–µ—Ç–∞ (`to_restore/1`, `to_restore/2` –∏ —Ç.–¥.).
4.  –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ñ–∞–π–ª–∞ `list.yaml` –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤—Ö–æ–¥–Ω—ã—Ö –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤.
5.  –í—ã–∑–æ–≤ `squash_manager.fish` –¥–ª—è —É–ø–∞–∫–æ–≤–∫–∏ —ç—Ç–æ–≥–æ —Å–∫–µ–ª–µ—Ç–∞ –≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π) –æ–±—Ä–∞–∑.
6.  –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ namespace –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—á–∏—â–∞–µ—Ç –≤—Å–µ —Ç–æ—á–∫–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, –Ω–µ –æ—Å—Ç–∞–≤–ª—è—è –º—É—Å–æ—Ä–∞ –≤ –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ.

## 3. –ú–µ—Ö–∞–Ω–∏–∑–º—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
* **–í–∞–ª–∏–¥–∞—Ü–∏—è:** –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ `squashfs` –æ–±—Ä–∞–∑–∞ –ø–µ—Ä–µ–¥ —Ç–µ–º, –∫–∞–∫ —Å–æ–æ–±—â–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –æ–± —É—Å–ø–µ—à–Ω–æ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –∫–æ–º–∏—Ä–æ–≤–∞–Ω–∏—è.
* **–ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ `rm-if-empty` (–≤–º–µ—Å—Ç–æ `rm -rf`) –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤ —Å–±–æ—Ä–∫–∏. –≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –µ—Å–ª–∏ bind-mount –ø–æ –∫–∞–∫–æ–π-—Ç–æ –ø—Ä–∏—á–∏–Ω–µ –Ω–µ –æ—Ç—Ü–µ–ø–∏–ª—Å—è, —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã (—Ç–∞–∫ –∫–∞–∫ –∫–∞—Ç–∞–ª–æ–≥ –±—É–¥–µ—Ç –Ω–µ –ø—É—Å—Ç).

## 4. –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ (Fish Function)
* **–Ø–∑—ã–∫:** Fish shell scripting.
* **–ü—Ä–∏–Ω—Ü–∏–ø KISS:** –ö–æ–¥ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø—Ä–æ—Å—Ç—ã–º –∏ –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–º.
* **User-Space Friendly:** –ù–µ —Ç—Ä–µ–±–æ–≤–∞—Ç—å `sudo` –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π, –∫–æ—Ç–æ—Ä—ã–µ —ç—Ç–æ–≥–æ –Ω–µ —Ç—Ä–µ–±—É—é—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–∏—á–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è). Root-–ø—Ä–∞–≤–∞ –∑–∞–ø—Ä–∞—à–∏–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è `mount`, `cryptsetup` –∏ `unshare`.



## 5. –¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏–π –∞–ª–≥–æ—Ä–∏—Ç–º

–í–æ—Ç –∫–∞–∫ —ç—Ç–æ –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å –≤–Ω—É—Ç—Ä–∏ —É—Ç–∏–ª–∏—Ç—ã (–ø—Å–µ–≤–¥–æ–∫–æ–¥ –ª–æ–≥–∏–∫–∏):

**–≠—Ç–∞–ø Freeze (–£–ø–∞–∫–æ–≤–∫–∞):**

1. –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –ø—É—Ç–µ–π: `targets = [/bin/bash, /home/user/docs]`.
2. –ó–∞–ø—É—Å–∫–∞–µ–º `unshare -m ...` (–∏–∑–æ–ª—è—Ü–∏—è).
3. –°–æ–∑–¥–∞–µ–º –±–∞–∑—É: `mkdir -p /tmp/build/to_restore`.
4. –û—Ç–∫—Ä—ã–≤–∞–µ–º `list.yaml` –Ω–∞ –∑–∞–ø–∏—Å—å.
5. `counter = 1`.
6. **–¶–∏–∫–ª** –ø–æ `targets`:
    - –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä: `mkdir /tmp/$zks_build/to_restore/$counter`.
    - –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø (—Ñ–∞–π–ª –∏–ª–∏ –ø–∞–ø–∫–∞).
    - **–ï—Å–ª–∏ –ø–∞–ø–∫–∞:**
        - `mount --bind $target /tmp/$zks_build/to_restore/$counter`.
    - **–ï—Å–ª–∏ —Ñ–∞–π–ª:**
        - `touch /tmp/$zks_build/to_restore/$counter/$(basename $target)`.
        - `mount --bind $target /tmp/$zks_build/to_restore/$counter/$(basename $target)`.
    - –ü–∏—à–µ–º –≤ YAML: `$counter: $target`.
    - `counter++`.
7. –í—ã–∑—ã–≤–∞–µ–º `squash_manager create ...`.

8. –ú–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ñ–∞–π–ª–æ–≤ –≤ —Å–∞–º–æ–π –ø–µ—Ä–≤–æ–π –≤–µ—Ä—Å–∏–∏ –ø–æ–∫–∞ —á—Ç–æ –Ω–µ —Ä–µ–∞–ª–∏–∑—É–µ–º, –ø–æ–∫–∞ –∑–∞–¥–∞—á–∞ –ø—Ä–æ—Å—Ç–æ —Å–æ–∑–¥–∞—Ç—å sqashfs-—Ñ–∞–π–ª, –≤—Å—ë –æ—Å—Ç–∞–ª—å–Ω–æ–µ –æ—Å—Ç–∞–ª—å–Ω–æ–µ —è –ø—Ä–æ–≤–µ—Ä—é –≤—Ä—É—á–Ω—É—é. –ö–ª—é—á –¥–ª—è –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è —Ç–æ–∂–µ –ø–æ–∫–∞ –Ω–µ –¥–µ–ª–∞–µ–º. –£–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Ç–æ–∂–µ –ø–æ–∫–∞ –Ω–µ –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º.
9. –ø–æ—Å–ª–µ –≤—ã—Ö–æ–¥–∞ –∏–∑ "–∑–æ–Ω—ã –¥–µ–π—Å—Ç–≤–∏—è" unshare –±–µ–∑–æ–ø–∞—Å–Ω–æ –æ—á–∏—â–∞–µ–º `/tmp/$zks_build/to_restore/` –ø—Ä–∏ –ø–æ–º–æ—â–∏ `rm-if-empty`,  `/tmp/$zks_build/list.yaml` —É–¥–∞–ª—è–µ–º –æ–±—ã—á–Ω—ã–º rm'–æ–º, –ø–æ—Å–ª–µ —á–µ–≥–æ, `/tmp/$zks_build/ mkdir'–æ–º
 

**–≠—Ç–∞–ø Thaw (–†–∞—Å–ø–∞–∫–æ–≤–∫–∞):**

1. –ú–æ–Ω—Ç–∏—Ä—É–µ–º –æ–±—Ä–∞–∑ (`squash_manager mount`).
2. –ß–∏—Ç–∞–µ–º `list.yaml`.
3. –í—ã–≤–æ–¥–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –ø—É—Ç–µ–π –∏ –ø—Ä–æ—á—É—é —Å–ª—É–∂–µ–±–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
4. **–¶–∏–∫–ª** `id, path` –∏–∑ YAML:
    
    - –í—ã–≤–æ–¥–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é: "–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `$path`?" (yes/no/all)
    - –ï—Å–ª–∏ –î–ê: `rsync -av /tmp/$zks_mount/to_restore/$id/ $path/`.
        - _–ù—é–∞–Ω—Å rsync:_ –°–ª–µ—à –≤ –∫–æ–Ω—Ü–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ (`$id/`) –æ–∑–Ω–∞—á–∞–µ—Ç "–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ". –≠—Ç–æ –∏–¥–µ–∞–ª—å–Ω–æ –ª–æ–∂–∏—Ç—Å—è –≤ –∫–æ–Ω—Ü–µ–ø—Ü–∏—é –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.


**–í–µ—Ä–¥–∏–∫—Ç:** –ò–¥–µ—è —Å `to_restore/[N]` + `list.yaml` ‚Äî **–∑–æ–ª–æ—Ç–æ–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç**. –û–Ω–∞ –ø—Ä–æ—Å—Ç–∞—è, –Ω–∞–¥–µ–∂–Ω–∞—è –∏ –≥–∏–±–∫–∞—è. –ù–∞—á–∏–Ω–∞–π—Ç–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é —Å—Ä–∞–∑—É —Å –Ω–µ—ë.

## 6. –ü—Ä–∏–º–µ—Ä —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ (—Ç—Ä–µ–±—É–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏)
```
function zero-kelvin-storage --description "–°–æ–∑–¥–∞–Ω–∏–µ Zero-Kelvin-Storage –±–µ–∫–∞–ø–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∏–∑–æ–ª—è—Ü–∏–∏ –∏ bind-mounts"
    
    #–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
    #zks freeze <–ø—É—Ç–∏ –∫ —Ñ–∞–π–ª–∞–º/–∫–∞—Ç–∞–ª–æ–≥–∞–º (–º–æ–∂–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ)> <–ø—É—Ç—å –∫ —Å–æ–∑–¥–∞–≤–∞–µ–º–æ–º—É squashfs-—Ñ–∞–π–ª—É>
    #zks freeze --read <—Ç–µ–∫—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª> <–ø—É—Ç—å –∫ —Å–æ–∑–¥–∞–≤–∞–µ–º–æ–º—É squashfs-—Ñ–∞–π–ª—É>
    #–ø—Ä–∏ —Ç–∞–∫–æ–º —Ñ–æ—Ä–º–∞—Ç–µ, –≤ —Ç–µ–∫—Å—Ç–æ–≤–æ–º —Ñ–∞–π–ª–µ —Å–æ–¥–µ—Ä–∂–∏—Ç—Å—è —Å–ø–∏—Å–æ–∫ –ø—É—Ç–µ–π: –æ–¥–Ω–∞ —Å—Ç—Ä–æ–∫–∞ = –æ–¥–∏–Ω –ø—É—Ç—å, –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏ –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è
    #zks --encrypt <–∞—Ä–≥—É–º–µ–Ω—Ç—ã>
    #–∫–ª—é—á encrypt –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –≤ squash_manager, –æ–Ω —Å–∞–º –≤—Å—ë —Å–¥–µ–ª–∞–µ—Ç
    #zks unfreeze <–ø—É—Ç—å –∫ squashfs-—Ñ–∞–π–ª—É>
    #(–ª–∏–±–æ –≥–æ–ª—ã–π squashfs, –ª–∏–±–æ –∑–∞–≤—ë—Ä–Ω—É—Ç—ã–π –≤ luks, squash_manager —Å–∞–º —Ä–∞–∑–±–µ—Ä—ë—Ç —á—Ç–æ –∏–º–µ–Ω–Ω–æ —Ç–∞–º)
    #–∫–æ–¥ –Ω–∏–∂–µ –ø–æ–∫–∞ —á—Ç–æ –Ω–µ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω –ø–æ–¥ —Ç–∞–∫–æ–π –≤–≤–æ–¥, –µ–≥–æ –Ω–∞–¥–æ –∞–¥–∞—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–º–µ–Ω–Ω–æ –ø–æ –Ω–µ–≥–æ
    #–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ –≤–Ω–µ—Å—è –ø—Ä–∏ —ç—Ç–æ–º –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —É–ª—É—á–µ–Ω–∏—è –µ—Å–ª–∏ –ø–æ–¥—Ä–µ–±—É—é—Ç—Å—è, –Ω–µ –æ—Ç—Å—Ç—É–ø–∞—è –ø—Ä–∏ —ç—Ç–æ–º –æ—Ç –ø—Ä–∏–Ω—Ü–∏–ø–∞ KISS
    
    #–∑–∞–¥–µ–ª –Ω–∞ –±—É–¥—É—â–µ–µ: zks clean <–ø—É—Ç—å –∫ squashfs-—Ñ–∞–π–ª—É> —Å–º–æ—Ç—Ä–∏–æ–≤–∞—Ç—å –æ–±–∑—Ä–∞–∑ –∏ —É–¥–∞–ª–∏—Ç—å –≤—Å—ë, —á—Ç–æ —Ç—É–¥–∞ –±—ã–ª–æ –ø–æ–ª–æ–∂–µ–Ω–æ (–∏–∑ —Ç–æ–≥–æ, —á—Ç–æ –æ—Å—Ç–∞–ª–æ—Å—å)
    #—Å –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏ –ø–æ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–º —Å—É–º–º–∞–º –∏/–∏–ª–∏ —Ä–∞–∑–º–µ—Ä–∞–º —Ñ–∞–π–ª–∞, —Å–∞–º –∞—Ä—Ö–∏–≤ –ø—Ä–∏ —ç—Ç–æ–º –Ω–µ –º–µ–Ω—è–µ–º
    #–Ω–æ –ø–æ–∫–∞ —è –Ω–µ —Å–æ–æ–±—â—É, —á—Ç–æ –≤–µ—Å—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª —Å freeze/unfreeze –∞ –ø—Ä–æ—Ç–µ—Å—Ç–∏–ª —ç—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤—ã–∞
      
       
    argparse 'e/encrypt' -- $argv
    or return 1

    set -l targets $argv
    if test (count $targets) -eq 0
        echo "–û—à–∏–±–∫–∞: –Ω–µ —É–∫–∞–∑–∞–Ω—ã —Ñ–∞–π–ª—ã –¥–ª—è –±–µ–∫–∞–ø–∞."
        return 1
    end

    # 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –≤–Ω—É—Ç—Ä—å unshare
    # –¢–∞–∫ –∫–∞–∫ unshare –∑–∞–ø—É—Å–∫–∞–µ—Ç –Ω–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å, –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ fish —Ç—É–¥–∞ –Ω–µ –ø–æ–ø–∞–¥—É—Ç —Å–∞–º–∏.
    # –°–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π —Å–ø–æ—Å–æ–± –ø–µ—Ä–µ–¥–∞—Ç—å —Å–ø–∏—Å–æ–∫ —Å–ª–æ–∂–Ω—ã—Ö –ø—É—Ç–µ–π (—Å –ø—Ä–æ–±–µ–ª–∞–º–∏) ‚Äî —á–µ—Ä–µ–∑ –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª.
    set -l build_id (random)
    set -l target_list_file "/tmp/zks_targets_$build_id.txt"
    string join \n -- $targets > $target_list_file
    
    # –ü—É—Ç—å –∫ –Ω–∞—à–µ–π –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º, —á—Ç–æ –æ–Ω–∞ –ª–µ–∂–∏—Ç —Ä—è–¥–æ–º –∏–ª–∏ –≤ $PATH)
    # –ù—É–∂–Ω–æ, —á—Ç–æ–±—ã –≤–Ω—É—Ç—Ä–∏ unshare –º—ã –º–æ–≥–ª–∏ —Å–¥–µ–ª–∞—Ç—å source
    set -l sq_man_path (functions --details squash_manager)
    if test -z "$sq_man_path"
        echo "–û—à–∏–±–∫–∞: squash_manager –Ω–µ –Ω–∞–π–¥–µ–Ω."
        return 1
    end

    # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∏–º—è –≤—ã—Ö–æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ (–ø—Ä–∏–º–µ—Ä)
    #set -l timestamp (date +%Y%m%d_%H%M%S)
    #set -l output_archive "/run/media/$USER/Backups/zks_backup_$timestamp.squashfs"
    #–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –Ω–µ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º. –ü—É—Ç—å –¥–æ–∂–µ–Ω –±—ã—Ç—å –∫ —Ñ–∞–π–ª—É –±–µ–∫–∞–ø–∞ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ–ª—É—á–µ–Ω –ø–æ—Å–ª–µ–¥–Ω–∏–º –∞—Ä–≥—É–º–µ–Ω—Ç–æ–º
    #–¢.–µ.–≤—Å–µ

    # –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, —á—Ç–æ–±—ã –æ–Ω–∏ –±—ã–ª–∏ –≤–∏–¥–Ω—ã –≤–Ω—É—Ç—Ä–∏ sudo unshare
    set -lx ZKS_TARGET_LIST $target_list_file
    set -lx ZKS_OUTPUT $output_archive
    set -lx ZKS_SQ_PATH $sq_man_path
    set -lx ZKS_ENCRYPT $_flag_encrypt
    set -lx ZKS_HOSTNAME (hostname)

    echo "üßä –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–∑–æ–ª—è—Ü–∏–∏ (unshare)..."

    # 2. –ó–ê–ü–£–°–ö –ò–ó–û–õ–ò–†–û–í–ê–ù–ù–û–ì–û –ü–†–û–¶–ï–°–°–ê
    # –ò—Å–ø–æ–ª—å–∑—É–µ–º sudo, —Ç–∞–∫ –∫–∞–∫ mount –∏ unshare —Ç—Ä–µ–±—É—é—Ç –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π.
    # –§–ª–∞–≥ --propagation private –∫—Ä–∏—Ç–∏—á–µ–Ω, —á—Ç–æ–±—ã –º–∞—É–Ω—Ç—ã –Ω–µ "—É—Ç–µ–∫–ª–∏" –≤ –æ—Å–Ω–æ–≤–Ω—É—é —Å–∏—Å—Ç–µ–º—É.
    sudo -E unshare -m --propagation private fish -c '
        # --- –í–ù–£–¢–†–ò NAMESPACE ---
        # –ó–¥–µ—Å—å –º—ã root, –∏ —É –Ω–∞—Å —Å–≤–æ—è —Ç–∞–±–ª–∏—Ü–∞ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.
        
        # 1. –ó–∞–≥—Ä—É–∂–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å
        source $ZKS_SQ_PATH

        # 2. –°–æ–∑–¥–∞–µ–º —Å–∫–µ–ª–µ—Ç
        set -l build_root "/tmp/zks_build_"(random)
        set -l restore_root "$build_root/to_restore"
        mkdir -p $restore_root

        # 3. –ù–∞—á–∏–Ω–∞–µ–º –ø–∏—Å–∞—Ç—å –º–∞–Ω–∏—Ñ–µ—Å—Ç
        set -l manifest "$build_root/list.yaml"
        echo "metadata:" > $manifest
        echo "  date: \"$(date)\"" >> $manifest
        echo "  host: \"$ZKS_HOSTNAME\"" >> $manifest
        echo "files:" >> $manifest

        # 4. –ß–∏—Ç–∞–µ–º —Å–ø–∏—Å–æ–∫ —Ü–µ–ª–µ–π –∏ —Å—Ç—Ä–æ–∏–º "–ù—É–º–µ—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã"
        set -l counter 1
        
        # –ß–∏—Ç–∞–µ–º —Ñ–∞–π–ª –ø–æ—Å—Ç—Ä–æ—á–Ω–æ
        cat $ZKS_TARGET_LIST | while read -l target_path
            if test -z "$target_path"; continue; end

            set -l container_dir "$restore_root/$counter"
            mkdir -p $container_dir
            
            # –ó–∞–ø–∏—Å—å –≤ YAML
            echo "  - id: $counter" >> $manifest
            echo "    original_path: \"$target_path\"" >> $manifest

            if test -d "$target_path"
                # === –õ–û–ì–ò–ö–ê –î–õ–Ø –ö–ê–¢–ê–õ–û–ì–ê ===
                # –ë–∏–Ω–¥–∏–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø–∞–ø–∫–∏ –ø—Ä—è–º–æ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
                # –í –∞—Ä—Ö–∏–≤–µ –±—É–¥–µ—Ç: /to_restore/1/<—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ>
                mount --bind "$target_path" "$container_dir"
                echo "    type: directory" >> $manifest
            else
                # === –õ–û–ì–ò–ö–ê –î–õ–Ø –§–ê–ô–õ–ê ===
                # –°–æ–∑–¥–∞–µ–º —Ñ–∞–π–ª-–∑–∞–≥–ª—É—à–∫—É –∏ –±–∏–Ω–¥–∏–º –≤ –Ω–µ–≥–æ
                # –í –∞—Ä—Ö–∏–≤–µ –±—É–¥–µ—Ç: /to_restore/1/filename.ext
                set -l fname (basename "$target_path")
                touch "$container_dir/$fname"
                mount --bind "$target_path" "$container_dir/$fname"
                echo "    type: file" >> $manifest
            end

            set counter (math $counter + 1)
        end

        # 5. –£–ø–∞–∫–æ–≤–∫–∞
        # –í—ã–∑—ã–≤–∞–µ–º squash_manager, –∫–æ—Ç–æ—Ä—ã–π —Ç–µ–ø–µ—Ä—å –≤–∏–¥–∏—Ç /tmp/zks_build –∫–∞–∫ —Ä–µ–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã.
        # –ü–µ—Ä–µ–¥–∞–µ–º —Ñ–ª–∞–≥ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è, –µ—Å–ª–∏ –±—ã–ª –∑–∞–¥–∞–Ω —Å–Ω–∞—Ä—É–∂–∏.
        set -l enc_arg ""
        if test -n "$ZKS_ENCRYPT"
            set enc_arg "--encrypt"
        end

        echo "üì¶ –£–ø–∞–∫–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö..."
        # –í–∞–∂–Ω–æ: —É–ø–∞–∫–æ–≤—ã–≤–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ build_root, —á—Ç–æ–±—ã –≤ –∫–æ—Ä–Ω–µ –∞—Ä—Ö–∏–≤–∞ —Å—Ä–∞–∑—É –ª–µ–∂–∞–ª–∏ to_restore –∏ list.yaml
        squash_manager create $enc_arg "$build_root" "$ZKS_OUTPUT"
        
        # –°—Ç–∞—Ç—É—Å –≤—ã—Ö–æ–¥–∞ –ø–µ—Ä–µ–¥–∞—Å—Ç—Å—è –Ω–∞—Ä—É–∂—É
        if test $status -eq 0
            exit 0
        else
            exit 1
        end
        
        # –ü—Ä–∏ –≤—ã—Ö–æ–¥–µ namespace —É–Ω–∏—á—Ç–æ–∂–∏—Ç—Å—è, –∏ –≤—Å–µ mount --bind –∏—Å—á–µ–∑–Ω—É—Ç —Å–∞–º–∏.
    '

    set -l exit_code $status

    # 3. –û–ß–ò–°–¢–ö–ê –í –û–°–ù–û–í–ù–û–ô –°–ò–°–¢–ï–ú–ï
    # –£–¥–∞–ª—è–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª —Å–æ —Å–ø–∏—Å–∫–æ–º
    rm $target_list_file

    # –û—á–∏—â–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–∞–ø–∫–∏ –±–∏–ª–¥–∞.
    # –¢–∞–∫ –∫–∞–∫ –º—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ unshare, –≤ /tmp/zks_build_* —Å–µ–π—á–∞—Å –ø—É—Å—Ç–æ (–Ω–µ—Ç –º–∞—É–Ω—Ç–æ–≤),
    # –Ω–æ –æ—Å—Ç–∞–ª–∏—Å—å –ø—É—Å—Ç—ã–µ –ø–∞–ø–∫–∏ "—Å–∫–µ–ª–µ—Ç–∞".
    # –ò—Å–ø–æ–ª—å–∑—É–µ–º –≤–∞—à—É –±–µ–∑–æ–ø–∞—Å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é (–ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º, —á—Ç–æ –æ–Ω–∞ –≤ PATH)
    # –ò–ª–∏ –ø—Ä–æ—Å—Ç–æ rm -rf, —Ç–∞–∫ –∫–∞–∫ –º—ã —É–≤–µ—Ä–µ–Ω—ã –≤ unshare, –Ω–æ rm-if-empty –±–µ–∑–æ–ø–∞—Å–Ω–µ–µ.
    
    # –ù–∞—Ö–æ–¥–∏–º –ø–∞–ø–∫—É –±–∏–ª–¥–∞ (–ø—Ä–∏—Ö–æ–¥–∏—Ç—Å—è –∏—Å–∫–∞—Ç—å –ø–æ –º–∞—Å–∫–µ, —Ç.–∫. random –±—ã–ª –≤–Ω—É—Ç—Ä–∏)
    # –í —Ä–µ–∞–ª—å–Ω–æ–º –∫–æ–¥–µ –ª—É—á—à–µ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å ID –±–∏–ª–¥–∞ –≤–Ω—É—Ç—Ä—å, —á—Ç–æ–±—ã –∑–Ω–∞—Ç—å –ø—É—Ç—å —Ç–æ—á–Ω–æ.
    # –î–ª—è –ø—Ä–∏–º–µ—Ä–∞ —É–¥–∞–ª–∏–º –≤—Å—ë –ø–æ—Ö–æ–∂–µ–µ (–±–µ–∑–æ–ø–∞—Å–Ω–æ, —Ç.–∫. –º–∞—É–Ω—Ç–æ–≤ –Ω–µ—Ç):
    for d in /tmp/zks_build_*
        # rm-if-empty $d  <-- –í–∞—à–∞ —Ñ—É–Ω–∫—Ü–∏—è
        rm -rf $d # <-- –ü–æ–∫–∞ –∑–∞–≥–ª—É—à–∫–∞
    end

    if test $exit_code -eq 0
        echo "‚úÖ –ë–µ–∫–∞–ø —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω: $output_archive"
    else
        echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –±–µ–∫–∞–ø–∞."
    end
end


```


## 7. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç

–î–ª—è —á–µ–≥–æ –∏–º–µ–Ω–Ω–æ —Å–æ–∑–¥–∞—ë—Ç—Å—è —ç—Ç–∞ —É—Ç–∏–ª–∏—Ç–∞ (fish-—Ñ—É–Ω–∫—Ü–∏—è)

### –§–∏–ª–æ—Å–æ—Ñ–∏—è: Offloading (–í—ã–≥—Ä—É–∑–∫–∞), –∞ –Ω–µ Backup (–†–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏–µ)

–≠—Ç–æ  –∫–ª—é—á–µ–≤–æ–µ –æ—Ç–ª–∏—á–∏–µ –æ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π (TimeShift, Borg, Restic).

- **–¶–µ–ª—å:** –û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –¥–∏—Å–∫–æ–≤–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ –Ω–∞ –Ω–æ—É—Ç–±—É–∫–µ (Arch Linux).
- **–°—É—Ç—å:** –ù–µ —Å—Ç–æ–ª—å–∫–æ —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏ (—Ö–æ—Ç—è –Ω–∞ NAS —Å RAID5-HDD —Ö—Ä–∞–Ω–∏—Ç—å –≤—Å—ë-—Ä–∞–≤–Ω–æ –±–µ–∑–æ–ø–∞—Å–Ω–µ–µ, —á–µ–º –Ω–∞ SSD –Ω–æ—É—Ç–∞), —Å–∫–æ–ª—å–∫–æ ¬´–∑–∞–º–æ—Ä–∞–∂–∏–≤–∞–Ω–∏–µ¬ª –ø—Ä–æ–µ–∫—Ç–æ–≤ –∏–ª–∏ –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä—ã–µ **–Ω–µ –Ω—É–∂–Ω—ã –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å**, –Ω–æ –º–æ–≥—É—Ç –ø–æ–Ω–∞–¥–æ–±–∏—Ç—å—Å—è –≤ –±—É–¥—É—â–µ–º.
- **–î–µ–π—Å—Ç–≤–∏–µ:** –î–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–Ω–æ—Å—è—Ç—Å—è –Ω–∞ –≤–Ω–µ—à–Ω–∏–π –Ω–æ—Å–∏—Ç–µ–ª—å (NAS –∏–ª–∏ HDD) —Å –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –¥–∏—Å–∫–∞.
### –ú–∏–Ω–∏–º–∏–∑–∞—Ü–∏—è ¬´—Ç–µ–ª–æ–¥–≤–∏–∂–µ–Ω–∏–π¬ª (Low Friction Restore)

- **–¶–µ–ª—å:** –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø–æ—á—Ç–∏ —Ç–∞–∫–∏–º –∂–µ –ø—Ä–æ—Å—Ç—ã–º, –∫–∞–∫ `Ctrl+Z` (–æ–±—Ä–∞–∑–Ω–æ –≥–æ–≤–æ—Ä—è).
- **–°—É—Ç—å:** –£—Ç–∏–ª–∏—Ç–∞ –¥–æ–ª–∂–Ω–∞ —Å–∞–º–∞ –ø–æ–º–Ω–∏—Ç—å, **–æ—Ç–∫—É–¥–∞** –±—ã–ª–∏ –≤–∑—è—Ç—ã —Ñ–∞–π–ª—ã.
- **–†–µ—à–µ–Ω–∏–µ:**
    - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –¥–æ–ª–∂–µ–Ω –≤—Ä—É—á–Ω—É—é —É–∫–∞–∑—ã–≤–∞—Ç—å: ¬´–†–∞—Å–ø–∞–∫—É–π —ç—Ç–æ—Ç –∞—Ä—Ö–∏–≤ –≤ `/home/user/project`¬ª.
    - –£—Ç–∏–ª–∏—Ç–∞ —á–∏—Ç–∞–µ—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –º–∞–Ω–∏—Ñ–µ—Å—Ç (`list.yaml`) –∏ —Å–∞–º–∞ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç: ¬´–≠—Ç–æ—Ç –∞—Ä—Ö–∏–≤ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ–∞–π–ª—ã –∏–∑ `/etc/nginx` –∏ `/home/user`. –í–µ—Ä–Ω—É—Ç—å –∏—Ö –Ω–∞ –º–µ—Å—Ç–æ?¬ª.
    - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö ID (–∏–º—è —Ö–æ—Å—Ç–∞ + –¥–∞—Ç–∞ + —Ç–µ–≥) –ø–æ–∑–≤–æ–ª—è–µ—Ç –±—ã—Å—Ç—Ä–æ –Ω–∞—Ö–æ–¥–∏—Ç—å –Ω—É–∂–Ω—ã–π "—Å–ª–µ–ø–æ–∫" —Å–∏—Å—Ç–µ–º—ã.
### –ì–∏–±–∫–æ—Å—Ç—å –∏ –ê—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å (Contextual Sets)

- **–¶–µ–ª—å:** –£–º–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –ª–æ–≥–∏—á–µ—Å–∫–∏ —Å–≤—è–∑–∞–Ω–Ω—ã–º–∏, –Ω–æ —Ñ–∏–∑–∏—á–µ—Å–∫–∏ —Ä–∞–∑—Ä–æ–∑–Ω–µ–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏.
- **–°—É—Ç—å:** –ü—Ä–æ–µ–∫—Ç ‚Äî —ç—Ç–æ —á–∞—Å—Ç–æ –Ω–µ –æ–¥–Ω–∞ –ø–∞–ø–∫–∞. –≠—Ç–æ ¬´–∫–æ–¥ –≤ `/home` + –∫–æ–Ω—Ñ–∏–≥ –≤ `/etc` + –±–∞–∑–∞ –≤ `/var`¬ª
- **–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ:** –£—Ç–∏–ª–∏—Ç–∞ –¥–æ–ª–∂–Ω–∞ —É–º–µ—Ç—å —Å–æ–±—Ä–∞—Ç—å —ç—Ç–∏ —Ä–∞–∑–±—Ä–æ—Å–∞–Ω–Ω—ã–µ –ø—É—Ç–∏ –≤ **–æ–¥–∏–Ω** –∞—Ä—Ö–∏–≤–Ω—ã–π —Ñ–∞–π–ª. –ò –ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ —Ä–∞–∑–ª–æ–∂–∏—Ç—å –∏—Ö –æ–±—Ä–∞—Ç–Ω–æ –ø–æ –ø–æ–ª–æ—á–∫–∞–º, –Ω–µ —Å–æ–∑–¥–∞–≤–∞—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –∏–º–µ–Ω (—Ä–µ—à–µ–Ω–æ —á–µ—Ä–µ–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –Ω—É–º–µ—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ `1/`, `2/`).

### User-Space Friendly (–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞)

- **–¶–µ–ª—å:** –ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ–≤—ã—à–µ–Ω–∏–µ –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π (`sudo`/`doas`) —Ç–∞–º, –≥–¥–µ —ç—Ç–æ –Ω–µ –Ω—É–∂–Ω–æ.
- **–°—É—Ç—å:** –ï—Å–ª–∏ –≤—ã –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç–µ —Å–≤–æ–∏ –ª–∏—á–Ω—ã–µ —Ñ–∞–π–ª—ã –≤ –¥–æ–º–∞—à–Ω—é—é –ø–∞–ø–∫—É, —É—Ç–∏–ª–∏—Ç–∞ –Ω–µ –¥–æ–ª–∂–Ω–∞ —Ç—Ä–µ–±–æ–≤–∞—Ç—å root-–ø—Ä–∞–≤. Root –Ω—É–∂–µ–Ω —Ç–æ–ª—å–∫–æ –¥–ª—è —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –ø—É—Ç–µ–π –∏–ª–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (—Ö–æ—Ç—è –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ `udisks` –∏–ª–∏ `squashfuse` –≤ –±—É–¥—É—â–µ–º –º–æ–≥–ª–æ –±—ã —Ä–µ—à–∏—Ç—å –∏ —ç—Ç–æ, –Ω–æ –ø–æ–∫–∞ –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º `sudo` –¥–ª—è `mount`).
### KISS –∏ Native (Arch Way)

- **–¶–µ–ª—å:** –ü—Ä–æ—Å—Ç–æ—Ç–∞, –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è.
- **–°—É—Ç—å:**
    - –ù–∏–∫–∞–∫–∏—Ö –¥–µ–º–æ–Ω–æ–≤, –≤–∏—Å—è—â–∏—Ö –≤ —Ñ–æ–Ω–µ.        
    - –ù–∏–∫–∞–∫–∏—Ö —Å–ª–æ–∂–Ω—ã—Ö –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö (–≤—Å—ë —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ —Ñ–∞–π–ª–∞—Ö –∏ –≤–Ω—É—Ç—Ä–∏ —Å–∞–º–∏—Ö –∞—Ä—Ö–∏–≤–æ–≤).
    - –ù–∞–ø–∏—Å–∞–Ω–æ –Ω–∞ **Fish**, –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—É –∏–∑ –¥–∞–Ω–Ω–æ–π —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–π –æ–±–æ–ª–æ—á–∫–∏.
    - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö Linux-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ (`rsync`, `mksquashfs`, `cryptsetup`), —á—Ç–æ–±—ã –¥–∞–Ω–Ω—ã–µ –º–æ–∂–Ω–æ –±—ã–ª–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å ¬´—Ä—É–∫–∞–º–∏¬ª, –¥–∞–∂–µ –µ—Å–ª–∏ —É—Ç–∏–ª–∏—Ç–∞ `zks` –∏—Å—á–µ–∑–Ω–µ—Ç.
        

**–ò—Ç–æ–≥ –æ–¥–Ω–æ–π —Ñ—Ä–∞–∑–æ–π:**

–ù—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å **–ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—É—é, —à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—É—é ¬´–∫—Ä–∏–æ–∫–∞–º–µ—Ä—É¬ª** –¥–ª—è –ø—Ä–æ–µ–∫—Ç–æ–≤ –∏ –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–¥–Ω–∏–º –¥–≤–∏–∂–µ–Ω–∏–µ–º –æ—Å–≤–æ–±–æ–∂–¥–∞—Ç—å –º–µ—Å—Ç–æ –Ω–∞ –Ω–æ—É—Ç–±—É–∫–µ –∏ —Ç–∞–∫ –∂–µ –ª–µ–≥–∫–æ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –≤—Å—ë –æ–±—Ä–∞—Ç–Ω–æ, —Å–æ—Ö—Ä–∞–Ω—è—è —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—É—Ç–µ–π –∏ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞.
